# 头像上传401错误 - 快速修复指南

## 🚀 快速解决方案

### 步骤1：检查Token状态

1. 打开浏览器开发者工具（按F12）
2. 切换到 Console（控制台）标签
3. 输入以下命令并按回车：

```javascript
debugAuth()
```

### 步骤2：根据结果采取行动

#### 情况A：Token已过期
```
❌ Token已过期！
```
**解决方法：** 重新登录
```
1. 点击页面右上角"退出登录"
2. 使用 admin / admin123 重新登录
3. 再次尝试上传头像
```

#### 情况B：Token不存在
```
❌ Token不存在
```
**解决方法：** 清除缓存并登录
```
1. 按 F12 打开开发者工具
2. 切换到 Application 标签
3. 左侧选择 Local Storage > http://localhost:3008
4. 点击右键 → Clear
5. 刷新页面（F5）
6. 重新登录
```

#### 情况C：Token有效但仍401
```
✅ Token有效 (剩余 XXX 分钟)
```
**解决方法：** 测试API连接
```javascript
testAuthAPI()
```
查看返回结果，如果还是401，可能是后端服务问题。

## 🔄 最简单的方法：强制重新登录

如果不想排查，直接执行：

```
1. 按 F12 打开控制台
2. 输入: localStorage.clear()
3. 刷新页面: F5
4. 重新登录: admin / admin123
5. 测试上传头像
```

## ✅ 验证修复成功

上传头像后应该看到：

```
✅ 控制台显示: "头像已上传: http://localhost:8005/uploads/..."
✅ 头像立即更新显示
✅ 刷新页面后头像保持不变
```

## 📱 Windows PowerShell命令（可选）

如果想测试后端API是否正常，在项目backend目录运行：

```powershell
cd H:\momo-ruanjiansheji\AI-XsRead\backend
node test-avatar-upload.js
```

看到 ✅ 头像上传成功 说明后端正常。

## 🆘 还是不行？

尝试完整重启：

```powershell
# 停止前端服务（Ctrl+C）
# 停止后端服务（Ctrl+C）

# 重启后端
cd H:\momo-ruanjiansheji\AI-XsRead\backend
npm run dev

# 新开终端，重启前端
cd H:\momo-ruanjiansheji\AI-XsRead\ai-xsread-vue3
npm run dev

# 清除浏览器缓存
# 访问 http://localhost:3008
# 重新登录测试
```

---

**需要帮助？** 请提供以下信息：
1. `debugAuth()` 的完整输出
2. Network标签中 `/api/upload/avatar` 请求的详细信息
3. 浏览器控制台的错误信息截图

