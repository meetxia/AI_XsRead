# TXT小说上传功能使用手册

**功能版本：** v1.0  
**创建时间：** 2025-10-28  
**适用角色：** 作者/管理员  

---

## 📚 功能概述

作为作者，你现在可以直接在网站上传TXT格式的小说，系统会自动：
- ✅ 解析文件内容
- ✅ 生成小说简介
- ✅ 智能分类
- ✅ 存入数据库
- ✅ 立即可在网站阅读

**一键上传，即刻发布！** 🚀

---

## 🎯 快速开始（3步搞定）

### 步骤1：登录账号

访问网站并登录你的作者账号：
```
http://localhost:3008
```

测试账号：
- 用户名：`reader001` (或任何已注册账号)
- 密码：`123456`

### 步骤2：进入上传页面

点击右上角**头像** → 在下拉菜单中点击 **"上传小说"**

```
┌────────────────┐
│   [头像]  ▼    │
├────────────────┤
│ 👤 个人中心    │
│ 📚 我的书架    │
│ ☁️ 上传小说 ← │ ⭐ 点击这里
│ 🚪 退出登录    │
└────────────────┘
```

### 步骤3：上传TXT文件

**方式A：拖拽上传**
- 直接将TXT文件拖拽到上传区域

**方式B：选择文件**
- 点击"选择文件"按钮
- 选择一个或多个TXT文件
- 点击"开始上传"

**完成！** 🎉
- 上传成功后会显示结果
- 点击"查看"按钮可以立即查看小说

---

## 💡 详细使用指南

### 1. 准备TXT文件

#### 1.1 文件格式要求

**✅ 正确示例：**
```
文件名：他说，你只需要适应我一个人就够了.txt
编码：UTF-8
大小：<10MB
内容：完整的小说正文
```

**❌ 错误示例：**
```
文件名：1.txt （标题不清晰）
编码：GBK （可能乱码）
大小：15MB （超过限制）
内容：只有几行字 （太短）
```

#### 1.2 文件命名规范

**推荐格式：**
- ✅ 清晰明确的小说标题
- ✅ 例如：`霸道总裁的替身娇妻.txt`
- ✅ 文件名会自动成为小说标题

**避免格式：**
- ❌ `novel1.txt` - 太简单
- ❌ `【完结】【推荐】小说名.txt` - 太多标记
- ❌ 包含特殊符号：`<>:"/\|?*`

#### 1.3 内容要求

- **最小字数：** 500字
- **推荐字数：** 5000字以上
- **最大字数：** 不超过100万字（超长建议分章节）
- **编码格式：** UTF-8（避免乱码）

---

### 2. 上传操作

#### 2.1 单文件上传

```
1. 点击"选择文件"
2. 选择1个TXT文件
3. 点击"开始上传"
4. 等待上传完成（几秒钟）
5. 查看上传结果
```

#### 2.2 批量上传

```
1. 点击"选择文件"
2. 按住Ctrl/Cmd选择多个文件
   或：直接拖拽多个文件
3. 查看文件列表
4. 点击"开始上传"
5. 等待所有文件上传完成
```

**批量上传限制：**
- 最多一次上传：50个文件
- 单个文件最大：10MB
- 总大小建议：<100MB

#### 2.3 上传结果说明

上传完成后会显示三种状态：

**✅ 成功上传**
- 显示小说标题和字数
- 可以点击"查看"按钮阅读

**⏭️ 已存在**
- 数据库中已有同名小说
- 需要修改文件名重新上传

**❌ 上传失败**
- 显示失败原因
- 常见原因：
  - 内容太短（<500字）
  - 文件格式错误
  - 标题格式不符

---

### 3. 自动处理功能

系统会自动完成以下工作：

#### 3.1 智能分类

根据标题关键词自动分类：

| 分类 | 关键词示例 |
|------|-----------|
| 现代言情 | 总裁、豪门、婚姻、恋爱、暧昧、闪婚 |
| 古风穿越 | 穿越、重生、古风、宫廷、王爷 |
| 悬疑推理 | 悬疑、推理、真相、杀手、死亡 |
| 治愈系 | 治愈、温暖、咖啡、相遇、温柔 |
| 玄幻奇幻 | 修真、仙侠、玄幻、大佬、师兄 |
| 科幻未来 | 科幻、星际、游戏、虚拟、测试 |

**示例：**
```
文件名：霸道总裁爱上我.txt
→ 自动分类为：现代言情

文件名：穿越之嫡女归来.txt
→ 自动分类为：古风穿越
```

#### 3.2 自动生成简介

系统会提取内容的前200字作为简介：
```
原文内容：
你以为婚礼当天见到的陌生人只是走个形式，
直到他握住你的脚踝说："别躲，我有的是时间教你适应。"
第一章：指定
你是在父亲书房外听到自己被"处理掉"的...

自动简介：
你以为婚礼当天见到的陌生人只是走个形式，
直到他握住你的脚踝说："别躲，我有的是时间教你适应。"
第一章：指定 你是在父亲书房外听到自己被"处理掉"的...
```

#### 3.3 生成作者名

如果你的账号没有设置作者笔名，系统会自动生成：
- 温柔笔触
- 墨染流年
- 清风明月
- 等等...

**建议：** 在个人中心设置固定的笔名

#### 3.4 初始数据

新上传的小说会有初始数据：
- 浏览量：500-10,000（随机）
- 点赞数：50-1,000（随机）
- 收藏数：20-500（随机）
- 评分：4.0-5.0（随机）
- 状态：已发布

---

## 📖 上传后的效果

### 4.1 在首页展示

```
上传完成后，小说会立即出现在：
✅ 首页小说列表
✅ 推荐页（如果被标记为推荐）
✅ 搜索结果
✅ 对应分类页面
```

### 4.2 阅读体验

用户可以点击小说进入详情页，然后开始阅读：

```
┌─────────────────────────────────┐
│ 他说，你只需要适应我一个人就够了 │ ← 小说标题
├─────────────────────────────────┤
│ 字数: 8813  更新时间: 2025-10-28 │
│                                 │
│ 你以为婚礼当天见到的陌生人...     │
│ （完整内容）                     │
│                                 │
│        [返回详情页]              │
├─────────────────────────────────┤
│     [夜间] [设置] [书架]         │
└─────────────────────────────────┘
```

**特点：**
- 单章节显示小说标题
- 无章节导航（短篇小说）
- 支持阅读设置
- 支持收藏和分享

---

## 🔧 技术说明

### 5.1 上传流程

```
选择TXT文件
  ↓
前端验证（大小、格式）
  ↓
上传到后端 (POST /api/upload/novel)
  ↓
后端解析TXT内容
  ├── 提取标题（文件名）
  ├── 计算字数
  ├── 生成简介
  ├── 智能分类
  └── 验证数据
  ↓
存入数据库
  ├── INSERT INTO novels (小说记录)
  └── INSERT INTO chapters (章节内容)
  ↓
返回结果
  ↓
前端显示成功信息
```

### 5.2 数据库结构

**novels表（小说信息）：**
```sql
id, title, author, author_id, category_id,
description, word_count, chapter_count (固定为1),
status, views, likes, rating, ...
```

**chapters表（章节内容）：**
```sql
id, novel_id, chapter_number (固定为1),
title (固定为"正文"), content (完整TXT内容),
word_count, is_free (固定为1)
```

### 5.3 API接口

**单个上传：**
```
POST /api/upload/novel
Content-Type: multipart/form-data
Authorization: Bearer {token}

Body: {
  file: [TXT文件]
}

Response: {
  code: 200,
  message: "小说上传成功",
  data: {
    novelId: 45,
    title: "小说标题",
    wordCount: 8813
  }
}
```

**批量上传：**
```
POST /api/upload/novels/batch
Content-Type: multipart/form-data
Authorization: Bearer {token}

Body: {
  files: [TXT文件数组]
}

Response: {
  code: 200,
  data: {
    total: 10,
    successCount: 9,
    failedCount: 1,
    existsCount: 0,
    details: { ... }
  }
}
```

---

## ❓ 常见问题

### Q1: 上传后看不到小说？

**原因：**
- 可能被分页了，刷新首页或搜索小说标题
- 检查上传结果中的状态

**解决：**
```
1. 在上传结果页点击"查看"按钮
2. 或在首页搜索小说标题
3. 或访问：http://localhost:3008/novel/{novelId}
```

### Q2: 提示"已存在同名小说"？

**原因：**
- 数据库中已有同标题的小说

**解决：**
```
方案1：修改文件名（添加副标题）
  例如：原名.txt → 原名-修订版.txt

方案2：删除数据库中的旧记录
  在个人中心查看"我的小说"，删除旧版本
```

### Q3: 上传失败"内容太短"？

**原因：**
- 文件字数少于500字

**解决：**
```
1. 检查文件内容是否完整
2. 短篇小说建议至少5000字
3. 如果是测试，可以临时降低限制
```

### Q4: 上传后出现乱码？

**原因：**
- 文件编码不是UTF-8

**解决：**
```
1. 用记事本打开TXT文件
2. 点击"文件" → "另存为"
3. 编码选择"UTF-8"
4. 保存并重新上传
```

### Q5: 分类不对怎么办？

**解决：**
```
方案1：修改文件名，添加分类关键词
  例如：我的小说.txt → 穿越之我的小说.txt

方案2：上传后在数据库中手动修改
  UPDATE novels SET category_id = 102 WHERE id = ?
```

---

## 🎨 本次导入成果

### 已导入的34本小说

| 小说标题 | 字数 | 分类 |
|---------|------|------|
| 不会说话的你，被政界新贵指定联姻 | 10,966 | 现代言情 |
| 为了气前任我找了个牛郎，结果他是京圈太子爷 | 8,880 | 现代言情 |
| 他们说，只能选一个 | 8,209 | 现代言情 |
| 他说，你只需要适应我一个人就够了 | 8,813 | 现代言情 |
| 和已故学长恋爱后，监控里出现了另一个他 | 17,855 | 悬疑推理 |
| 女杀手的隐退计划，被病娇丈夫搅黄了 | 8,034 | 悬疑推理 |
| 废材小师妹被顶级大师兄偷偷藏了十年 | 10,538 | 玄幻奇幻 |
| 我在测试恋爱游戏，三个男人都是真心的 | 7,910 | 科幻未来 |
| ... | ... | ... |

**总计：** 34本，约35万字

**访问地址：**
```
首页：http://localhost:3008
推荐页：http://localhost:3008/recommend
搜索：搜索小说标题即可找到
```

---

## 🛠️ 高级功能

### 批量上传技巧

**1. 准备多个文件**
```
data/
├── 小说1.txt
├── 小说2.txt
├── 小说3.txt
└── ...
```

**2. 全选上传**
```
Ctrl+A 全选 → 拖拽到上传区
或
点击"选择文件" → Ctrl+A → 确定
```

**3. 查看结果**
```
✅ 成功: 30个
⏭️ 已存在: 3个
❌ 失败: 1个
```

### 管理我的小说

**查看已上传的小说：**
```
方式1：个人中心 → 我的小说
方式2：API接口 GET /api/upload/my-novels
```

**编辑小说信息：**
```
（功能开发中）
将来可以在个人中心编辑：
- 标题
- 简介
- 分类
- 封面
```

---

## 📊 系统限制

### 文件限制

| 项目 | 限制 | 说明 |
|------|------|------|
| 文件格式 | .txt | 只支持TXT格式 |
| 文件编码 | UTF-8 | 推荐使用UTF-8 |
| 单文件大小 | 10MB | 约500万字 |
| 批量上传数量 | 50个 | 一次最多50个 |
| 最小字数 | 500字 | 太短会被拒绝 |
| 最大字数 | 100万字 | 超长建议分章 |

### 权限要求

| 功能 | 游客 | 登录用户 | 作者/管理员 |
|------|------|---------|-----------|
| 浏览小说 | ✅ | ✅ | ✅ |
| 阅读小说 | ✅ | ✅ | ✅ |
| 上传小说 | ❌ | ✅ | ✅ |
| 编辑小说 | ❌ | ⚠️ 自己的 | ✅ 所有 |
| 删除小说 | ❌ | ⚠️ 自己的 | ✅ 所有 |

---

## 🎬 使用演示

### 场景1：新作者首次上传

```
1. 注册账号并登录
2. 写好TXT小说（例如：我的第一部作品.txt）
3. 点击头像 → "上传小说"
4. 拖拽文件到上传区
5. 点击"开始上传"
6. 等待3-5秒
7. 看到"✅ 成功上传 1"
8. 点击"查看"按钮
9. 进入小说详情页
10. 点击"开始阅读"
11. 完美！读者可以阅读了
```

### 场景2：批量上传历史作品

```
1. 准备多个TXT文件（例如：30个短篇）
2. 登录作者账号
3. 进入上传页面
4. 拖拽所有30个文件
5. 检查文件列表
6. 点击"开始上传"
7. 等待30-60秒
8. 查看结果：
   ✅ 成功28个
   ⏭️ 已存在2个（之前上传过）
   ❌ 失败0个
9. 完成！30篇作品全部上线
```

---

## 📱 移动端使用

移动端同样支持上传功能：

```
1. 手机浏览器访问网站
2. 登录账号
3. 点击右上角头像
4. 选择"上传小说"
5. 点击"选择文件"
6. 从手机存储选择TXT文件
7. 点击"开始上传"
```

**注意：** 建议在电脑端使用，体验更好

---

## ⚡ 性能说明

### 上传速度

| 文件大小 | 预计时间 |
|---------|---------|
| 1MB以下 | < 2秒 |
| 1-5MB | 2-5秒 |
| 5-10MB | 5-10秒 |
| 批量10个 | 10-30秒 |

**影响因素：**
- 网络速度
- 服务器性能
- 文件大小
- 并发上传数量

### 并发限制

- 同时上传：建议不超过10个文件
- 如需上传更多：分批上传
- 服务器会排队处理

---

## 🎯 最佳实践

### 文件准备

```
✅ 推荐做法：
1. 统一使用UTF-8编码
2. 文件名清晰明确
3. 内容完整无误
4. 字数5000以上
5. 批量上传前先测试1个

❌ 避免做法：
1. 使用GBK等编码
2. 文件名太简单
3. 内容不完整
4. 一次上传太多
5. 不检查就上传
```

### 上传策略

**小批量上传：**
- 5-10个文件一批
- 逐批上传
- 便于检查和修正

**命名规范：**
- 使用完整标题
- 避免特殊符号
- 便于分类和搜索

**分类优化：**
- 标题包含分类关键词
- 或上传后手动调整

---

## 📝 总结

### ✅ 功能优势

1. **简单易用** - 3步完成上传
2. **自动化处理** - 无需手动输入信息
3. **批量支持** - 一次上传50个文件
4. **即时发布** - 上传即可阅读
5. **智能分类** - 自动识别类型

### 🎯 使用场景

1. **作者投稿** - 将写好的TXT小说快速发布
2. **历史迁移** - 批量导入历史作品
3. **测试验证** - 快速上传测试内容
4. **内容更新** - 上传新章节或新作品

### 📞 技术支持

如遇问题，可以：
1. 查看上传结果页的错误提示
2. 检查浏览器控制台的错误信息
3. 查看本使用手册的常见问题
4. 联系技术支持

---

## 📎 相关文件

**后端文件：**
- `backend/src/utils/txtParser.js` - 解析工具
- `backend/src/controllers/uploadController.js` - 控制器
- `backend/src/routes/upload.js` - 路由配置

**前端文件：**
- `ai-xsread-vue3/src/api/upload.js` - API调用
- `ai-xsread-vue3/src/views/UploadNovelPage.vue` - 上传页面
- `ai-xsread-vue3/src/components/common/AppHeader.vue` - 菜单入口

**数据目录：**
- `H:\momo-ruanjiansheji\AI_XsRead\data\` - TXT文件存放

---

**文档版本：** v1.0  
**最后更新：** 2025-10-28  
**功能状态：** ✅ 已完成并可用  
**访问地址：** http://localhost:3008/upload

