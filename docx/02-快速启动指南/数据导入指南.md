# 数据导入指南

> 快速导入测试数据到数据库

---

## 📋 前置条件

- ✅ MySQL 服务已启动
- ✅ 数据库 `ai_xsread` 已创建
- ✅ 数据表已初始化（运行过 database_init.sql）
- ✅ 后端依赖已安装

---

## 🚀 方法一：使用自动化脚本（推荐）

### Windows 系统

```powershell
# 进入后端目录
cd H:\momo-ruanjiansheji\AI_XsRead\backend

# 确保依赖已安装
npm install

# 运行导入脚本
node scripts/import-seed-data.js

# 或者双击运行批处理文件
# backend/scripts/import-seed-data.bat
```

### 导入成功标志

看到以下输出表示成功：

```
============================================================
🌱 开始导入种子数据...
============================================================

📝 正在生成密码哈希...
✅ 密码哈希生成成功
   测试账号密码: 123456

🔌 正在连接数据库...
   主机: 127.0.0.1
   数据库: ai_xsread
✅ 数据库连接成功

📄 正在读取 SQL 文件...
✅ SQL 文件读取成功

⚙️  正在执行 SQL 语句...
✅ SQL 执行成功

📊 数据统计:
   👤 用户数: 7
   📂 分类数: 6
   📚 小说数: 10
   📖 章节数: 50+

============================================================
🎉 种子数据导入完成！
============================================================
```

---

## 🛠️ 方法二：使用 phpMyAdmin

### 步骤1：打开 phpMyAdmin

浏览器访问: http://127.0.0.1/phpmyadmin/

### 步骤2：登录

- 用户名: `toefl_user`
- 密码: `mojz168168-`

### 步骤3：选择数据库

点击左侧的 `ai_xsread` 数据库

### 步骤4：导入 SQL 文件

1. 点击顶部 "导入" 标签
2. 点击 "选择文件"
3. 选择文件: `H:\momo-ruanjiansheji\AI_XsRead\docx\seed_data_complete.sql`
4. **重要**: 在导入前，需要先生成真实密码哈希

### 步骤5：生成密码哈希

在导入前，需要替换 SQL 文件中的密码占位符。

运行以下命令生成密码哈希：

```powershell
cd backend
node scripts/generate-password.js
```

复制生成的哈希值，打开 `seed_data_complete.sql`，将所有的：
```
$2b$10$YQ7Zv5K5xG0mH5xJ5xK5xO5xL5xM5xN5xO5xP5xQ5xR5xS5xT5xU
```

替换为生成的真实哈希值。

### 步骤6：执行导入

点击 "执行" 按钮，等待导入完成。

---

## 🛠️ 方法三：使用 MySQL 命令行

```powershell
# 1. 生成密码哈希
cd backend
node scripts/generate-password.js

# 2. 登录 MySQL
mysql -u toefl_user -p
# 输入密码: mojz168168-

# 3. 使用数据库
USE ai_xsread;

# 4. 导入 SQL 文件
source H:/momo-ruanjiansheji/AI_XsRead/docx/seed_data_complete.sql;

# 5. 验证导入
SHOW TABLES;
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM novels;

# 6. 退出
EXIT;
```

---

## 📊 导入的数据内容

### 测试账号 (7个)

| 用户名 | 邮箱 | 密码 | 角色 |
|--------|------|------|------|
| reader001 | reader001@example.com | 123456 | 普通用户 |
| reader002 | reader002@example.com | 123456 | 普通用户 |
| reader003 | reader003@example.com | 123456 | 普通用户 |
| author001 | author001@example.com | 123456 | 作者 |
| author002 | author002@example.com | 123456 | 作者 |
| author003 | author003@example.com | 123456 | 作者 |
| admin | admin@example.com | 123456 | 管理员 |

> 🔑 所有账号的密码都是: **123456**

### 分类数据 (6个)

- 都市言情 🏙️
- 古风穿越 🏯
- 玄幻修仙 ⚔️
- 悬疑推理 🔍
- 科幻未来 🚀
- 青春校园 📚

### 小说数据 (10本)

每本小说包含：
- 完整的基本信息
- 统计数据（浏览、点赞、收藏）
- 5-10 个章节
- 前2章免费，其余付费

### 章节数据 (50+章)

每本小说至少包含 5 个章节，用于测试阅读功能。

---

## ✅ 验证导入结果

### 1. 在 phpMyAdmin 中验证

访问: http://127.0.0.1/phpmyadmin/

检查以下表的数据：
- `users` 表应该有 7 条记录
- `categories` 表应该有 6 条记录
- `novels` 表应该有 10 条记录
- `chapters` 表应该有 50+ 条记录

### 2. 使用 API 测试

启动后端服务：

```powershell
cd backend
npm run dev
```

测试接口：

```bash
# 1. 测试登录
POST http://localhost:8000/api/auth/login
Content-Type: application/json

{
  "username": "reader001",
  "password": "123456"
}

# 2. 测试获取小说列表
GET http://localhost:8000/api/novels

# 3. 测试获取小说详情
GET http://localhost:8000/api/novels/1

# 4. 测试获取章节列表
GET http://localhost:8000/api/novels/1/chapters

# 5. 测试获取章节内容
GET http://localhost:8000/api/chapters/1
```

---

## 🐛 常见问题

### 问题1: 数据库连接失败

```
错误: ECONNREFUSED
```

**解决方案:**
- 确认 MySQL 服务已启动
- 检查 `backend/.env` 中的数据库配置

### 问题2: 密码验证失败

```
错误: 用户名或密码错误
```

**解决方案:**
- 确保导入时使用了真实的 bcrypt 哈希
- 重新运行 `generate-password.js` 生成密码
- 重新导入数据

### 问题3: 数据库不存在

```
错误: ER_BAD_DB_ERROR
```

**解决方案:**
- 先创建数据库: `CREATE DATABASE ai_xsread;`
- 再运行导入脚本

### 问题4: 表不存在

```
错误: Table doesn't exist
```

**解决方案:**
- 先运行 `database_init.sql` 初始化表结构
- 再运行 `seed_data_complete.sql` 导入数据

### 问题5: 重复数据错误

```
错误: Duplicate entry
```

**解决方案:**
方式1 - 清空数据后重新导入:
```sql
DELETE FROM reading_history;
DELETE FROM reading_progress;
DELETE FROM bookshelf;
DELETE FROM user_likes;
DELETE FROM comments;
DELETE FROM chapters;
DELETE FROM novels;
DELETE FROM categories;
DELETE FROM users;
```

方式2 - SQL 文件已包含 `ON DUPLICATE KEY UPDATE`，直接导入会更新现有数据

---

## 🔄 重新导入数据

如果需要重新导入（清空所有数据）：

```powershell
cd backend
node scripts/import-seed-data.js
```

脚本会自动处理重复数据。

---

## 📚 相关文档

- [database_init.sql](./database_init.sql) - 数据库初始化脚本
- [seed_data_complete.sql](./seed_data_complete.sql) - 完整种子数据
- [后端服务创建完成报告.md](./后端服务创建完成报告.md) - 后端文档
- [Windows本地开发快速启动指南.md](./Windows本地开发快速启动指南.md) - 完整开发指南

---

## 🎯 下一步

数据导入成功后，您可以：

1. ✅ 启动后端服务
   ```powershell
   cd backend
   npm run dev
   ```

2. ✅ 启动前端服务
   ```powershell
   cd ai-xsread-vue3
   pnpm run dev
   ```

3. ✅ 测试登录功能
   - 用户名: reader001
   - 密码: 123456

4. ✅ 测试小说列表、详情、章节等功能

---

**🎉 祝您测试顺利！**

*最后更新: 2025-10-27*

