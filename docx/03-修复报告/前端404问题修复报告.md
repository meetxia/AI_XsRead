# 前端404问题修复报告

## 问题描述
前端页面无法加载数据，浏览器控制台显示 404 错误：
```
GET http://localhost:3008/api/novels?page=1&pageSize=12 404 (Not Found)
```

## 问题分析

### 错误的请求流程
```
前端请求: /api/novels?page=1&pageSize=12
    ↓
Vite代理 (错误配置): 去掉 /api 前缀
    ↓
转发到后端: http://localhost:8005/novels?page=1&pageSize=12
    ↓
后端路由匹配失败: 404 (后端期望 /api/novels)
```

### 根本原因
**Vite 代理配置错误：**
```javascript
// ❌ 错误配置
proxy: {
  '/api': {
    target: 'http://localhost:8005',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api/, '')  // 这行导致问题
  }
}
```

**后端路由配置：**
```javascript
// backend/src/routes/index.js
const API_PREFIX = '/api';
router.use(`${API_PREFIX}/novels`, novelRoutes);  // 需要 /api 前缀
```

## 解决方案

### 修改 `ai-xsread-vue3/vite.config.js`

**修改前：**
```javascript
proxy: {
  '/api': {
    target: 'http://localhost:8005',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api/, '')  // 删除这行
  }
}
```

**修改后：**
```javascript
proxy: {
  '/api': {
    target: 'http://localhost:8005',
    changeOrigin: true  // 保留 /api 前缀
  }
}
```

### 正确的请求流程
```
前端请求: /api/novels?page=1&pageSize=12
    ↓
Vite代理 (正确配置): 保留 /api 前缀
    ↓
转发到后端: http://localhost:8005/api/novels?page=1&pageSize=12
    ↓
后端路由匹配成功: 返回数据 ✅
```

## 重启步骤

### 1. 停止当前前端服务
在运行 `pnpm run dev` 的终端中按 `Ctrl + C`

### 2. 重新启动前端
```bash
cd ai-xsread-vue3
pnpm run dev
```

或使用项目根目录的启动脚本：
```bash
.\启动开发环境.bat
```

### 3. 验证修复
打开浏览器访问 `http://localhost:3008`，应该能看到：
- ✅ 小说数据正常显示
- ✅ 控制台没有 404 错误
- ✅ 网络请求返回 200 状态码

## 技术总结

### Vite 代理工作原理
```javascript
// 配置
proxy: {
  '/api': {
    target: 'http://localhost:8005',
    changeOrigin: true
  }
}

// 匹配规则：
// 前端请求以 /api 开头 → 代理到 target
// 不以 /api 开头 → 直接访问前端资源
```

### 常见配置场景

**场景1：后端有 /api 前缀（本项目）**
```javascript
// 后端: http://localhost:8005/api/novels
proxy: {
  '/api': {
    target: 'http://localhost:8005',
    changeOrigin: true
    // 不需要 rewrite
  }
}
```

**场景2：后端没有 /api 前缀**
```javascript
// 后端: http://localhost:8005/novels
proxy: {
  '/api': {
    target: 'http://localhost:8005',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api/, '')  // 需要去掉
  }
}
```

## 相关文件

- **前端代理配置**: `ai-xsread-vue3/vite.config.js`
- **前端API配置**: `ai-xsread-vue3/.env.development`
- **后端路由配置**: `backend/src/routes/index.js`
- **后端主配置**: `backend/src/app.js`

## 修复时间
2025-10-27

## 修复人员
AI 全栈技术支持

