# 书架功能快速测试指南

## 1. 重启后端服务

```bash
# 进入后端目录
cd backend

# 重启服务
npm start
```

## 2. 清除前端缓存

打开浏览器开发者工具（F12），执行以下操作：
1. 进入 Application 标签
2. 选择 Local Storage
3. 删除所有 localStorage 数据
4. 刷新页面（F5）

## 3. 测试流程

### 步骤 1: 登录
- 访问 `http://localhost:3008`
- 使用测试账号登录（如果没有请先注册）

### 步骤 2: 添加书籍到书架
- 进入首页或推荐页
- 找到任意一本小说
- 点击小说进入详情页
- 点击"加入书架"按钮
- 确认按钮文字变为"已在书架"

### 步骤 3: 查看书架
- 点击底部导航栏的"书架"图标
- 确认刚才添加的书籍显示在"正在读"标签下
- 检查书籍信息是否完整（封面、标题、作者）

### 步骤 4: 测试统计数据
- 在书架页面顶部查看统计卡片
- 确认"正在阅读"数量为 1
- 确认"书架总数"为 1

### 步骤 5: 测试多本书籍
- 返回首页
- 再添加 2-3 本不同的书籍到书架
- 返回书架页面
- 确认所有书籍都正确显示
- 确认统计数据正确更新

## 4. 检查控制台

### 浏览器控制台（F12 > Console）
应该没有错误信息，特别是：
- ✅ 没有 "Unknown column 'created_at'" 错误
- ✅ 没有 401 认证错误
- ✅ 没有数据格式错误

### 网络请求（F12 > Network）
检查以下 API 请求：
1. **POST /api/user/bookshelf**
   - Status: 201 Created
   - Response: `{ code: 201, message: "添加成功" }`

2. **GET /api/user/bookshelf**
   - Status: 200 OK
   - Response: 包含书籍数组的数据

3. **GET /api/user/statistics**
   - Status: 200 OK
   - Response: 包含统计数据

## 5. 预期结果

### ✅ 成功标志
- [ ] 添加书籍时没有报错
- [ ] 书架页面显示添加的书籍
- [ ] 书籍信息完整（标题、作者、封面）
- [ ] 统计数据正确
- [ ] 可以切换不同标签（正在读、已读完、收藏）
- [ ] 可以从书架移除书籍

### ❌ 如果仍有问题

#### 问题 1: 添加书架时报错
**检查**:
- 后端服务是否正常运行
- 数据库连接是否正常
- 检查后端控制台错误日志

#### 问题 2: 书架显示空白
**检查**:
- 打开浏览器控制台查看错误
- 检查 Network 标签，查看 API 请求是否成功
- 检查 localStorage 中是否有 bookshelf 数据

#### 问题 3: 数据格式错误
**检查**:
- 确认后端返回的数据格式
- 检查前端 store 中的数据转换逻辑
- 查看浏览器控制台的错误信息

## 6. 调试技巧

### 查看 localStorage 数据
在浏览器控制台执行：
```javascript
console.log(JSON.parse(localStorage.getItem('bookshelf')))
```

### 查看 store 状态
在 Vue DevTools 中：
1. 打开 Vue DevTools
2. 选择 Pinia 标签
3. 查看 bookshelf store 的状态
4. 确认 reading、finished、collected 数组

### 手动触发数据刷新
在浏览器控制台执行：
```javascript
// 获取 store 实例
const bookshelfStore = useBookshelfStore()
// 重新获取数据
await bookshelfStore.fetchBookshelf()
```

## 7. 常见问题

### Q: 添加成功但书架不显示？
A: 尝试刷新页面，或清除 localStorage 后重新登录

### Q: 统计数据不准确？
A: 检查后端 `/api/user/statistics` 接口返回的数据

### Q: 书籍显示但没有封面？
A: 检查数据库中小说的 cover 字段是否有值

## 8. 成功截图位置

测试成功后，请截图以下内容：
1. 书架页面（显示书籍列表）
2. 统计卡片（显示正确的数量）
3. 浏览器控制台（无错误）
4. Network 标签（API 请求成功）

保存截图到：`test-results/bookshelf-fix-验证-{日期}.png`

