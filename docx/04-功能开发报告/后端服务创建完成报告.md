# åç«¯æœåŠ¡åˆ›å»ºå®ŒæˆæŠ¥å‘Š

> æ–‡å­—ä¹‹å¢ƒ - Backend API Service  
> åˆ›å»ºæ—¥æœŸ: 2025-10-27

---

## ğŸ“‹ åˆ›å»ºæ¦‚è¿°

åç«¯æœåŠ¡å·²æˆåŠŸåˆ›å»ºå®Œæˆï¼åŸºäº Express.js æ„å»ºçš„ RESTful API æœåŠ¡ï¼ŒåŒ…å«å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€å°è¯´ç®¡ç†ã€ä¹¦æ¶ç®¡ç†ç­‰åŠŸèƒ½æ¨¡å—ã€‚

---

## ğŸ¯ å·²å®Œæˆçš„å·¥ä½œ

### 1. âœ… é¡¹ç›®ç»“æ„æ­å»º

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.js                  # âœ… ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ config/                 # âœ… é…ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ database.js
â”‚   â”œâ”€â”€ controllers/            # âœ… æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”œâ”€â”€ novelController.js
â”‚   â”‚   â””â”€â”€ userController.js
â”‚   â”œâ”€â”€ routes/                 # âœ… è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ novels.js
â”‚   â”‚   â”œâ”€â”€ chapters.js
â”‚   â”‚   â”œâ”€â”€ user.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ middlewares/            # âœ… ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â”‚   â””â”€â”€ logger.js
â”‚   â””â”€â”€ utils/                  # âœ… å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ response.js
â”‚       â””â”€â”€ validators.js
â”œâ”€â”€ package.json                # âœ… ä¾èµ–é…ç½®
â”œâ”€â”€ .gitignore                  # âœ… Gitå¿½ç•¥é…ç½®
â””â”€â”€ README.md                   # âœ… é¡¹ç›®æ–‡æ¡£
```

### 2. âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°

#### è®¤è¯æ¨¡å— (AuthController)
- âœ… ç”¨æˆ·æ³¨å†Œ (`POST /api/auth/register`)
- âœ… ç”¨æˆ·ç™»å½• (`POST /api/auth/login`)
- âœ… ä»¤ç‰Œåˆ·æ–° (`POST /api/auth/refresh`)
- âœ… è·å–å½“å‰ç”¨æˆ· (`GET /api/auth/me`)
- âœ… ç”¨æˆ·ç™»å‡º (`POST /api/auth/logout`)

#### å°è¯´æ¨¡å— (NovelController)
- âœ… è·å–å°è¯´åˆ—è¡¨ (`GET /api/novels`)
- âœ… è·å–å°è¯´è¯¦æƒ… (`GET /api/novels/:id`)
- âœ… è·å–æ¨èå°è¯´ (`GET /api/novels/recommend`)
- âœ… æœç´¢å°è¯´ (`GET /api/novels/search`)
- âœ… è·å–ç« èŠ‚åˆ—è¡¨ (`GET /api/novels/:novelId/chapters`)
- âœ… è·å–ç« èŠ‚å†…å®¹ (`GET /api/chapters/:id`)
- âœ… è·å–åˆ†ç±»åˆ—è¡¨ (`GET /api/novels/categories`)

#### ç”¨æˆ·æ¨¡å— (UserController)
- âœ… è·å–ä¹¦æ¶ (`GET /api/user/bookshelf`)
- âœ… æ·»åŠ åˆ°ä¹¦æ¶ (`POST /api/user/bookshelf`)
- âœ… ä»ä¹¦æ¶ç§»é™¤ (`DELETE /api/user/bookshelf/:novelId`)
- âœ… è·å–é˜…è¯»è¿›åº¦ (`GET /api/user/reading-progress/:novelId`)
- âœ… æ›´æ–°é˜…è¯»è¿›åº¦ (`POST /api/user/reading-progress`)
- âœ… è·å–é˜…è¯»å†å² (`GET /api/user/reading-history`)

### 3. âœ… ä¸­é—´ä»¶é…ç½®

- âœ… **JWTè®¤è¯ä¸­é—´ä»¶**: ä¿æŠ¤éœ€è¦ç™»å½•çš„è·¯ç”±
- âœ… **é”™è¯¯å¤„ç†ä¸­é—´ä»¶**: ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- âœ… **è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶**: è®°å½•æ‰€æœ‰APIè¯·æ±‚
- âœ… **å‚æ•°éªŒè¯ä¸­é—´ä»¶**: éªŒè¯è¯·æ±‚å‚æ•°åˆæ³•æ€§
- âœ… **CORSä¸­é—´ä»¶**: è·¨åŸŸè¯·æ±‚æ”¯æŒ
- âœ… **å®‰å…¨å¤´éƒ¨**: ä½¿ç”¨ Helmet å¢å¼ºå®‰å…¨æ€§
- âœ… **å“åº”å‹ç¼©**: ä½¿ç”¨ Compression å‹ç¼©å“åº”
- âœ… **é™æµä¿æŠ¤**: ä½¿ç”¨ Rate-Limit é˜²æ­¢æ»¥ç”¨

### 4. âœ… æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Express | ^4.18.2 | Webæ¡†æ¶ |
| MySQL2 | ^3.6.0 | æ•°æ®åº“é©±åŠ¨ |
| JWT | ^9.0.2 | ç”¨æˆ·è®¤è¯ |
| bcryptjs | ^2.4.3 | å¯†ç åŠ å¯† |
| cors | ^2.8.5 | è·¨åŸŸæ”¯æŒ |
| helmet | ^7.1.0 | å®‰å…¨å¤´éƒ¨ |
| compression | ^1.7.4 | å“åº”å‹ç¼© |
| express-validator | ^7.0.1 | å‚æ•°éªŒè¯ |
| express-rate-limit | ^7.1.5 | è¯·æ±‚é™æµ |
| dotenv | ^16.3.1 | ç¯å¢ƒå˜é‡ |
| nodemon | ^3.0.2 | çƒ­é‡è½½ |

---

## ğŸš€ å¯åŠ¨æ–¹å¼

### Windows ç³»ç»Ÿ

```powershell
# 1. è¿›å…¥åç«¯ç›®å½•
cd H:\momo-ruanjiansheji\AI_XsRead\backend

# 2. å®‰è£…ä¾èµ–
npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
npm run dev

# æˆ–è€…ç”Ÿäº§æ¨¡å¼
npm start
```

### å¯åŠ¨æˆåŠŸæ ‡å¿—

çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š

```
ğŸ” æ­£åœ¨æµ‹è¯•æ•°æ®åº“è¿æ¥...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

========================================
ğŸš€ æ–‡å­—ä¹‹å¢ƒåç«¯æœåŠ¡å¯åŠ¨æˆåŠŸï¼
========================================
ğŸ“ æœåŠ¡åœ°å€: http://localhost:8000
ğŸŒ ç¯å¢ƒæ¨¡å¼: development
ğŸ“Š APIæ–‡æ¡£: http://localhost:8000/api/health
========================================
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.env)

åç«¯ä½¿ç”¨ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ï¼Œä¸»è¦é…ç½®é¡¹ï¼š

```env
# æœåŠ¡å™¨é…ç½®
PORT=8000                          # æœåŠ¡ç«¯å£
NODE_ENV=development               # ç¯å¢ƒæ¨¡å¼

# æ•°æ®åº“é…ç½®
DB_HOST=127.0.0.1                 # æ•°æ®åº“ä¸»æœº
DB_PORT=3306                       # æ•°æ®åº“ç«¯å£
DB_USER=toefl_user                # æ•°æ®åº“ç”¨æˆ·å
DB_PASSWORD=mojz168168-           # æ•°æ®åº“å¯†ç 
DB_DATABASE=ai_xsread             # æ•°æ®åº“åç§°

# JWTé…ç½®
JWT_SECRET=your-secret-key-change-in-production-2025
JWT_EXPIRES_IN=2h                 # è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸ
JWT_REFRESH_SECRET=your-refresh-secret-key-change-in-production-2025
JWT_REFRESH_EXPIRES_IN=7d         # åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸ

# CORSé…ç½®
CORS_ORIGIN=http://localhost:3008 # å…è®¸çš„å‰ç«¯åœ°å€
```

> **æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…ä¿®æ”¹ JWT_SECRET å’Œ JWT_REFRESH_SECRETï¼

---

## ğŸ“¡ APIæµ‹è¯•

### 1. å¥åº·æ£€æŸ¥

```bash
GET http://localhost:8000/api/health
```

å“åº”ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "status": "healthy",
    "timestamp": 1698765432000,
    "uptime": 123.456
  }
}
```

### 2. ç”¨æˆ·æ³¨å†Œ

```bash
POST http://localhost:8000/api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "123456",
  "confirmPassword": "123456"
}
```

### 3. ç”¨æˆ·ç™»å½•

```bash
POST http://localhost:8000/api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "123456"
}
```

å“åº”ï¼š
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 7200,
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com"
    }
  }
}
```

### 4. è·å–å°è¯´åˆ—è¡¨

```bash
GET http://localhost:8000/api/novels?page=1&pageSize=10
```

### 5. è·å–å°è¯´è¯¦æƒ…

```bash
GET http://localhost:8000/api/novels/1
```

### 6. æ·»åŠ åˆ°ä¹¦æ¶ï¼ˆéœ€è¦ç™»å½•ï¼‰

```bash
POST http://localhost:8000/api/user/bookshelf
Authorization: Bearer <your_token>
Content-Type: application/json

{
  "novelId": 1
}
```

---

## ğŸ“Š ç»Ÿä¸€å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": { /* å®é™…æ•°æ® */ },
  "timestamp": 1698765432000
}
```

### é”™è¯¯å“åº”

```json
{
  "code": 400,
  "message": "å‚æ•°é”™è¯¯",
  "errors": [
    {
      "field": "username",
      "message": "ç”¨æˆ·åä¸èƒ½ä¸ºç©º"
    }
  ],
  "timestamp": 1698765432000
}
```

### åˆ†é¡µå“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": [ /* åˆ—è¡¨æ•°æ® */ ],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "total": 100,
    "totalPages": 5
  },
  "timestamp": 1698765432000
}
```

---

## âœ… åŠŸèƒ½ç‰¹æ€§

### 1. å®‰å…¨ç‰¹æ€§

- âœ… **å¯†ç åŠ å¯†**: ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- âœ… **JWTè®¤è¯**: åŸºäºä»¤ç‰Œçš„æ— çŠ¶æ€è®¤è¯
- âœ… **ä»¤ç‰Œåˆ·æ–°**: æ”¯æŒè®¿é—®ä»¤ç‰Œè‡ªåŠ¨åˆ·æ–°
- âœ… **å®‰å…¨å¤´éƒ¨**: Helmet é˜²æŠ¤å¸¸è§Webæ¼æ´
- âœ… **è¯·æ±‚é™æµ**: é˜²æ­¢æš´åŠ›æ”»å‡»å’ŒAPIæ»¥ç”¨
- âœ… **CORSæ§åˆ¶**: ä¸¥æ ¼çš„è·¨åŸŸè®¿é—®æ§åˆ¶

### 2. æ€§èƒ½ä¼˜åŒ–

- âœ… **æ•°æ®åº“è¿æ¥æ± **: å¤ç”¨æ•°æ®åº“è¿æ¥
- âœ… **å“åº”å‹ç¼©**: Gzipå‹ç¼©å‡å°‘ä¼ è¾“ä½“ç§¯
- âœ… **åˆ†é¡µæŸ¥è¯¢**: é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®
- âœ… **ç´¢å¼•ä¼˜åŒ–**: æ•°æ®åº“è¡¨å·²æ·»åŠ å¿…è¦ç´¢å¼•

### 3. å¼€å‘ä½“éªŒ

- âœ… **çƒ­é‡è½½**: nodemon è‡ªåŠ¨é‡å¯æœåŠ¡
- âœ… **è¯·æ±‚æ—¥å¿—**: è¯¦ç»†çš„è¯·æ±‚å“åº”æ—¥å¿—
- âœ… **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”
- âœ… **å‚æ•°éªŒè¯**: express-validator è‡ªåŠ¨éªŒè¯
- âœ… **ä»£ç ç»“æ„**: æ¸…æ™°çš„åˆ†å±‚æ¶æ„

---

## ğŸ”— ä¸å‰ç«¯å¯¹æ¥

### 1. å‰ç«¯é…ç½®

å‰ç«¯ `vite.config.js` éœ€é…ç½®ä»£ç†ï¼š

```javascript
server: {
  port: 3008,
  proxy: {
    '/api': {
      target: 'http://localhost:8000',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '')
    }
  }
}
```

### 2. å‰ç«¯è¯·æ±‚ç¤ºä¾‹

```javascript
// src/api/request.js
import axios from 'axios'

const request = axios.create({
  baseURL: 'http://localhost:8000/api',
  timeout: 10000
})

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(config => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers['Authorization'] = `Bearer ${token}`
  }
  return config
})

export default request
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åç«¯ README](../backend/README.md)
- [APIæ¥å£è®¾è®¡æ–‡æ¡£](./APIæ¥å£è®¾è®¡æ–‡æ¡£.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)
- [Windowsæœ¬åœ°å¼€å‘å¿«é€Ÿå¯åŠ¨æŒ‡å—](./Windowsæœ¬åœ°å¼€å‘å¿«é€Ÿå¯åŠ¨æŒ‡å—.md)

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸè®¡åˆ’
- [ ] æ·»åŠ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¤´åƒã€å°é¢ï¼‰
- [ ] å®ç°è¯„è®ºåŠŸèƒ½
- [ ] æ·»åŠ ç‚¹èµ/æ”¶è—åŠŸèƒ½
- [ ] å®Œå–„ç”¨æˆ·ä¸ªäººä¸­å¿ƒ

### é•¿æœŸè®¡åˆ’
- [ ] æ·»åŠ  Redis ç¼“å­˜å±‚
- [ ] å®ç°å…¨æ–‡æœç´¢ï¼ˆElasticsearchï¼‰
- [ ] æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆBull/RabbitMQï¼‰
- [ ] å®ç°å®æ—¶é€šçŸ¥ï¼ˆWebSocketï¼‰
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] APIæ–‡æ¡£ç”Ÿæˆï¼ˆSwaggerï¼‰

---

## ğŸ› å·²çŸ¥é—®é¢˜

ç›®å‰æ— å·²çŸ¥é—®é¢˜ã€‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. [Windowsæœ¬åœ°å¼€å‘å¿«é€Ÿå¯åŠ¨æŒ‡å—](./Windowsæœ¬åœ°å¼€å‘å¿«é€Ÿå¯åŠ¨æŒ‡å—.md) - å¸¸è§é—®é¢˜è§£å†³
2. [åç«¯ README](../backend/README.md) - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
3. [APIæ¥å£è®¾è®¡æ–‡æ¡£](./APIæ¥å£è®¾è®¡æ–‡æ¡£.md) - æ¥å£è¯¦ç»†è¯´æ˜

---

## ğŸ‰ æ€»ç»“

âœ… **åç«¯æœåŠ¡å·²å®Œæ•´åˆ›å»ºå¹¶å¯æ­£å¸¸è¿è¡Œï¼**

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- å®Œæ•´çš„ RESTful API å®ç°
- å®‰å…¨çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- æ¸…æ™°çš„ä»£ç ç»“æ„
- å®Œå–„çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„å¼€å‘æ–‡æ¡£

**ç«‹å³å¼€å§‹ï¼š**
```powershell
cd backend
npm install
npm run dev
```

è®¿é—® http://localhost:8000 å³å¯çœ‹åˆ°æœåŠ¡ä¿¡æ¯ï¼

---

*æŠ¥å‘Šç”Ÿæˆæ—¥æœŸ: 2025-10-27*  
*åç«¯ç‰ˆæœ¬: v1.0.0*  
*æ¡†æ¶: Express.js 4.18*

