# 阅读进度功能测试指南

## 快速测试步骤

### 步骤1: 准备测试

1. 确保前端开发服务器正在运行
2. 确保后端服务器正在运行
3. 确保已登录系统

### 步骤2: 开始阅读测试

1. **打开任意小说**
   - 进入首页或小说列表
   - 点击任意小说进入阅读页面

2. **观察控制台日志**
   - 打开浏览器开发者工具（F12）
   - 查看Console标签
   - 应该看到：
     ```
     📊 进度保存定时器已启动，每30秒自动保存
     ```

3. **等待30秒**
   - 保持页面打开，继续阅读
   - 30秒后，控制台应该显示：
     ```
     ✅ 阅读进度已保存到服务器: XX%
     ```

4. **翻页或切换章节**
   - 进行翻页操作
   - 控制台应该立即显示进度保存日志

### 步骤3: 验证书架显示

1. **返回书架**
   - 点击返回按钮或导航到书架页面
   - 查看刚才阅读的小说

2. **检查进度显示**
   - 书籍卡片右下角应该显示进度徽章
   - 例如：`35%`、`60%` 等
   - 不应该显示 `0%` 或空白

### 步骤4: 验证数据库

运行检查脚本：

```bash
cd backend
node scripts/check-reading-progress.js
```

期望输出：

```
=== 检查阅读进度数据 ===

最近10条阅读进度记录:
----------------------------------------
用户: testuser
小说: 为了气前任我找了个牛郎，结果他是京圈太子爷
章节ID: null
进度: 35%
更新时间: 2025-10-31 16:30:00
----------------------------------------

=== 统计信息 ===
总用户数: 1
总小说数: 2
书架记录数: 2
有进度记录: 1  ← 应该大于0
无进度记录: 1
```

## 测试场景清单

### ✅ 基础功能测试

- [ ] 登录后打开小说，等待30秒，进度自动保存
- [ ] 切换章节，进度立即保存
- [ ] 翻页，进度立即保存
- [ ] 返回书架，进度正确显示

### ✅ 边界情况测试

- [ ] 未登录用户阅读，不保存进度（静默跳过）
- [ ] 网络断开时阅读，保存失败不影响阅读
- [ ] 快速切换章节，不会重复保存
- [ ] 离开页面（切换标签），立即保存进度

### ✅ 进度计算测试

- [ ] 章节模式：当前章节3/总章节10 = 30%
- [ ] 分页模式：当前页5/总页20 = 25%
- [ ] 翻页模式：虚拟页6/总虚拟页12 = 50%

### ✅ 多设备同步测试（可选）

- [ ] 设备A阅读到50%
- [ ] 设备B登录同一账号
- [ ] 设备B的书架应显示50%进度

## 常见问题排查

### 问题1: 进度始终显示0%

**检查清单：**
- [ ] 确认已登录
- [ ] 确认至少阅读30秒或进行了翻页操作
- [ ] 检查控制台是否有进度保存日志
- [ ] 检查控制台是否有错误信息
- [ ] 运行数据库检查脚本确认数据是否写入

### 问题2: 控制台没有进度保存日志

**检查清单：**
- [ ] 确认前端代码已更新
- [ ] 清除浏览器缓存并刷新页面
- [ ] 检查是否已登录（localStorage中有token）
- [ ] 检查网络请求是否正常（Network标签）

### 问题3: 进度保存失败

**检查清单：**
- [ ] 后端服务器是否正常运行
- [ ] 数据库连接是否正常
- [ ] 检查后端日志是否有错误
- [ ] 检查前端Network标签中的API响应

## 调试命令

### 查看最近的阅读进度记录

```sql
SELECT 
  rp.user_id,
  rp.novel_id,
  n.title,
  rp.chapter_id,
  rp.progress,
  rp.updated_at
FROM reading_progress rp
LEFT JOIN novels n ON rp.novel_id = n.id
ORDER BY rp.updated_at DESC
LIMIT 10;
```

### 查看特定用户的进度

```sql
SELECT 
  n.title,
  rp.progress,
  rp.updated_at
FROM reading_progress rp
INNER JOIN novels n ON rp.novel_id = n.id
WHERE rp.user_id = 1
ORDER BY rp.updated_at DESC;
```

### 手动插入测试数据

```sql
-- 插入测试进度（仅用于测试）
INSERT INTO reading_progress (user_id, novel_id, chapter_id, progress, created_at, updated_at)
VALUES (1, 1, NULL, 50, NOW(), NOW());
```

## 预期结果

修复成功后：

1. ✅ 用户阅读时，进度每30秒自动保存
2. ✅ 书架正确显示阅读进度（不再是0%）
3. ✅ 数据库reading_progress表有记录
4. ✅ 多设备可以同步阅读进度
5. ✅ 页面刷新后进度不丢失

## 测试完成标准

- [x] 至少完成2次阅读测试
- [x] 验证数据库有进度记录
- [x] 书架页面正确显示进度
- [x] 控制台无错误日志
- [x] 进度计算准确

---

**测试日期**: 2025-10-31  
**测试人员**: ___________  
**测试结果**: ⬜ 通过 / ⬜ 失败  
**备注**: ___________

